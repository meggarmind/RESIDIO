## **Feature Document: Billing & Payments Module**

### 1.0 Overview

This module manages all financial transactions for the estate. It is designed to handle variable service charges, different types of project levies, and a robust reconciliation process for offline payments (bank transfers) while being future-proofed for online gateways.

It will consist of two primary ledgers tied to each unit (**Service Charge Ledger** and **Mandatory Project Levy Ledger**) and two estate-wide ledgers (**Donations Fund** and **Petty Cash**).

---

### 2.0 Core Concept: Unit Types & Billing Profiles

This system uses a normalized, three-tier structure to manage service charges, ensuring scalability and easy bulk updates.

* **1. Billing Profiles (The Rates):** The `Estate Manager (EXCO)` first creates "Billing Profiles," which are simple rate cards.
    * *Example Profile Name:* "Standard 3-Bed Rate"
        * **Security Dues:** 50,000 NGN (Monthly)
    * *Example Profile Name:* "Commercial Rate"
        * **Security Dues:** 80,000 NGN (Monthly)

* **2. Unit Types (The Categories):** The `Estate Manager (EXCO)` then creates "Unit Types" and links them to a `Billing Profile`.
    * *Example Unit Type:* "3-Bedroom Apartment" -> *Linked to Profile:* "Standard 3-Bed Rate"
    * *Example Unit Type:* "Commercial Space" -> *Linked to Profile:* "Commercial Rate"

* **3. Units (The Physical Apartments):** When a unit is maintained in the system (e.g., A-101), it is assigned a "Unit Type."
    * *Example Unit:* "A-101" -> *Assigned Type:* "3-Bedroom Apartment"

**Workflow Benefit:** When it's time to bill, the system looks at Unit "A-101," sees it's a "3-Bedroom Apartment," follows that link to the "Standard 3-Bed Rate" profile, and generates an invoice for 50,000 NGN.

---

### 3.0 Feature: Charge & Levy Management (EXCO Dashboard)

#### 3.1 Service Charge (Security Dues)
* The system will have an **automated monthly invoice generator**. On a set day (e.g., 1st of the month), this job will:
    1.  Check every unit's `Unit Type` and its linked `Billing Profile`.
    2.  Generate a new invoice (a "snapshot-in-time") for the correct amount.
    3.  Post it to the unit's **Service Charge Ledger**.
    4.  Automatically email the invoice to the `Property Owner`.
* **Bulk Updating Rates (Your Scenario):**
    * To change the 3-Bedroom rate from 50,000 to 55,000, the `Estate Manager (EXCO)` **only edits the "Standard 3-Bed Rate" `Billing Profile`**.
    * All 40 units linked to this profile will *automatically* be billed 55,000 on the *next* billing cycle.
    * **Crucially:** All previously generated invoices (including unpaid ones for 50,000) are **not affected**. The outstanding balance is simply the sum of all unpaid invoices, old and new.

#### 3.2 Mandatory Project Levies
* The `Estate Manager (EXCO)` can create a new **"Mandatory Levy"** (e.g., "New Transformer Levy").
* When creating it, they will enter a **flat fee per unit**.
* They will then select all the `Property Owners` this levy applies to.
* The system will automatically calculate the total (e.g., Owner A has 3 units, $1000/unit = $3000 total invoice) and post this *single invoice* to the owner's **Mandatory Project Levy Ledger**.
* Invoices are generated and emailed instantly.

#### 3.3 Donations (Discretionary)
This **will not** be part of the billing ledger to avoid clutter. It will be a separate **"Fundraising"** module.
* `Estate Manager (EXCO)` can create a "Donation Drive" (e.g., "New Drainages Fund").
* Residents (and owners) can see this drive, pledge an amount, and log a payment.

#### 3.4 Petty Cash (Cash)
This will be a separate **"Petty Cash"** module to handle cash from gate fees.
* A simple interface for an admin to log: "Toll-Gate Fees - [Date] - [Amount]".
* This keeps petty cash revenue separate from the resident service charge ledgers.

---

### 4.0 Feature: Payment & Reconciliation (EXCO Dashboard)

This workflow is redesigned for a clear audit trail, separating *logging* a payment from *confirming* it.

#### 4.1 Single Payment Entry Mode
This is for logging a payment proof (e.g., via a WhatsApp screenshot) *before* it's confirmed in the bank statement.

1.  `Estate Manager (EXCO)` navigates to the unit's financial ledger.
2.  Clicks **"Log Pending Payment"**.
3.  Enters: **Amount Paid**, **Date of Payment**, **Payment Method**, and **Reference**.
4.  The system creates a payment record with the status **`Pending Confirmation`**.
5.  **User View:** The `Property Owner`'s invoice will remain **`Unpaid`**, but will now show a message: "A payment of 50,000 NGN is **Pending Confirmation**."

#### 4.2 Bulk Reconciliation Mode
This is for end-of-week or end-of-month bank statement uploads (e.g., CSV, Excel).

1.  `Estate Manager (EXCO)` uploads the bank statement.
2.  The system opens a "Reconciliation" screen and performs the following steps:
3.  **Step 1: Auto-Confirm Pending Payments.**
    * The system *first* scans the statement for transactions that match existing `Pending Confirmation` entries (by amount, reference, etc.).
    * It presents a list of matches (e.g., "Bank Txn [50k] matches Pending Payment for [Unit A-101]").
    * The admin confirms these matches. The payment status is updated from `Pending Confirmation` to **`Bank Confirmed`**, and the corresponding invoice is finally marked **`Paid`**.
4.  **Step 2: Reconcile Remaining Transactions.**
    * For the remaining *unmatched* bank transactions, the `Estate Manager (EXCO)` can manually tag each one:
        * Apply to **"Unit A-101 (Service Charge)"** -> This creates a *new payment record* and immediately sets its status to **`Bank Confirmed`** and the invoice to **`Paid`**.
        * Apply to **"Donations Fund"**
        * Tag as **"Expense (Bank Charge)"**
5.  **Step 3: Handle Unlinked Transactions.**
    * For any transactions the admin cannot identify, they click **[Move to Unlinked Journal]**. The transaction is removed from the reconciliation screen.

#### 4.3 Unlinked Journal
This is a new page in the admin dashboard, acting as a holding account for "unknown" money.

1.  The `Estate Manager (EXCO)` can review this list of unapplied bank transactions at any time.
2.  When a transaction is identified (e.g., a resident calls), the admin finds it in the journal, clicks **"Apply"**, and selects the correct unit/ledger.
3.  This action *creates a new payment record*, sets its status to **`Bank Confirmed`** (because it originated from a statement), and marks the relevant invoice as **`Paid`**.

---

### 5.0 Feature: Adjustments & Corrections (Disputes)

To maintain a clean audit trail, corrections are made via Credit/Debit Notes.

* **Credit Note:** To *reduce* an amount a resident owes (e.g., for a mistake or discount). This creates a credit on their account that can be applied to an invoice.
* **Debit Note:** To *add* a charge outside the normal billing cycle (e.g., for a damage repair). This creates a new, instant invoice.

---

### 6.0 Feature: Property Owner View ("My Finances")

1.  A main "Finances" tab.
2.  Two sub-tabs: **"Service Charge Ledger"** and **"Project Levy Ledger"**.
3.  Each tab shows a clear list of all invoices and their status:
    * **`Unpaid`** (May show a "Payment Pending Confirmation" message)
    * **`Paid`**
4.  Clear instructions on **"How to Pay"** (your bank account details).
5.  A **"Pay Now"** button (disabled for now, but ready for future online gateway integration).
6.  A full statement of account, showing all invoices, payments (pending or confirmed), and any credit/debit notes.